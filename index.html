<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio de Repaso - FICDE</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --ficde-azul-dark: #134252;
            --ficde-azul-light: #2c5c6e;
            --ficde-naranja: #e68161;
            --ficde-naranja-hover: #ff9f85;
            --tarjeta-bg: #f0f4f5;
            --input-bg: #e2e8eb;
            --texto-principal: #0f2d38;
            --texto-secundario: #4a636e;
            --verde-exito: #2e7d32;
            --verde-bg: #c8e6c9;
            --rojo-error: #c62828;
            --naranja-bg: #ffe0b2;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--ficde-azul-dark) 0%, #0a252e 100%);
            min-height: 100vh;
            color: var(--texto-principal);
            padding: 20px;
            background-attachment: fixed;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 16px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .logo-img { height: 50px; width: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }

        .module-tag {
            background: var(--ficde-naranja);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .welcome-card {
            background: var(--tarjeta-bg);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-bottom: 6px solid var(--ficde-naranja);
            margin-bottom: 30px;
        }

        .welcome-title {
            color: var(--ficde-azul-dark);
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .fede-avatar-large {
            width: 140px; height: 140px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            padding: 5px;
            box-shadow: 0 10px 25px rgba(230, 129, 97, 0.5);
            cursor: pointer;
            transition: transform 0.3s;
            overflow: hidden;
        }

        .fede-avatar-large:hover { transform: scale(1.1); }

        .fede-avatar-large img {
            width: 100%; height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid white;
        }

        .blocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .block-card {
            background: var(--tarjeta-bg);
            padding: 30px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .block-card:hover {
            transform: translateY(-8px);
            border-color: var(--ficde-naranja);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .block-icon {
            font-size: 3rem; margin-bottom: 15px;
            background: rgba(19, 66, 82, 0.1);
            width: 70px; height: 70px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; color: var(--ficde-azul-dark);
        }

        .block-title { color: var(--ficde-azul-dark); font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }

        .block-desc { color: var(--texto-secundario); font-size: 0.9rem; line-height: 1.5; }

        .activity-screen {
            display: none;
            grid-template-columns: 280px 1fr;
            gap: 25px;
            align-items: start;
        }

        .activity-screen.active { display: grid; }

        .tutor-sidebar {
            background: var(--ficde-azul-light);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            position: sticky; top: 20px;
        }

        .tutor-bubble {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            font-size: 0.95rem;
            color: var(--ficde-azul-dark);
            margin-top: 20px;
            position: relative;
            text-align: left;
        }

        .tutor-bubble::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            border-width: 0 10px 10px;
            border-style: solid;
            border-color: transparent transparent rgba(255,255,255,0.95);
            transform: translateX(-50%);
        }

        .activity-content {
            background: var(--tarjeta-bg);
            padding: 40px;
            border-radius: 16px;
            min-height: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .act-badge {
            background: var(--ficde-naranja);
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .act-title { font-size: 1.8rem; color: var(--ficde-azul-dark); margin: 15px 0; font-weight: 800; }

        .act-instruction { font-size: 1.1rem; color: var(--texto-secundario); margin-bottom: 30px; }

        .student-input {
            width: 100%;
            height: 150px;
            padding: 20px;
            background: var(--input-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: var(--ficde-azul-dark);
            transition: all 0.3s;
        }

        .student-input:focus { background: white; border-color: var(--ficde-naranja); outline: none; }

        .fill-input {
            border: none;
            border-bottom: 2px solid var(--ficde-naranja);
            background: transparent;
            font-weight: 700;
            color: var(--ficde-azul-dark);
            text-align: center;
            width: 150px;
            font-size: 1.1rem;
        }

        .btn-action {
            width: 100%;
            padding: 18px;
            margin-top: 30px;
            border: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            background: linear-gradient(90deg, var(--ficde-naranja), #ff9f85);
            color: white;
            box-shadow: 0 6px 20px rgba(230, 129, 97, 0.4);
            transition: transform 0.2s;
        }

        .btn-action:hover { transform: translateY(-3px); }

        .btn-back {
            background: transparent;
            color: var(--texto-secundario);
            box-shadow: none;
            border: 2px solid #ccc;
            margin-top: 15px;
        }

        .btn-back:hover { background: #e0e0e0; color: var(--ficde-azul-dark); }

        .traffic-row, .checklist-item {
            background: white;
            margin-bottom: 12px;
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .traffic-row:hover, .checklist-item:hover { border-color: var(--ficde-naranja); transform: translateX(5px); }

        .traffic-btn {
            width: 35px; height: 35px;
            border-radius: 50%; border: 2px solid #ddd;
            cursor: pointer;
            opacity: 0.3;
        }

        .traffic-btn.active { opacity: 1; transform: scale(1.2); border-color: var(--ficde-azul-dark); }

        .bg-green { background: #4CAF50; }

        .bg-yellow { background: #FFC107; }

        .bg-red { background: #f44336; }

        .check-box {
            width: 24px; height: 24px;
            border: 2px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .checklist-item.selected { border-color: var(--ficde-naranja); background: #fff5f0; }

        .checklist-item.selected .check-box { background: var(--ficde-naranja); border-color: var(--ficde-naranja); color: white; }

        .feedback-area {
            margin-top: 30px;
            padding: 25px;
            border-radius: 12px;
            display: none;
            animation: slideUp 0.4s;
        }

        .feedback-success { background: var(--verde-bg); color: #1b5e20; border-left: 6px solid var(--verde-exito); }

        .feedback-retry { background: var(--naranja-bg); color: #bf360c; border-left: 6px solid #ef6c00; }

        .feedback-fail { background: #cfd8dc; color: #37474f; border-left: 6px solid #455a64; }

        #musicToggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            color: white;
            border: none;
            cursor: pointer;
            z-index: 100;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .activity-screen { grid-template-columns: 1fr; }
            .tutor-sidebar { display: flex; align-items: center; gap: 20px; }
            .fede-avatar-large { width: 80px; height: 80px; }
            .tutor-bubble::after { display: none; }
        }
    </style>
</head>

<body>
    <!-- AUDIOS MP3 - Todos en la misma carpeta -->
    <audio id="bgMusic" loop preload="auto">
        <source src="chill-study-desk-focus-concentration-lofi-451180.mp3" type="audio/mpeg">
    </audio>

    <audio id="saludoInicial" preload="auto" src="saludoinicial.mp3"></audio>
    <audio id="mensaje1Ejercicios" preload="auto" src="mensaje1ejercicios.mp3"></audio>
    <audio id="mensaje2Ejercicios" preload="auto" src="mensaje2ejercicios.mp3"></audio>
    <audio id="mensaje3Ejercicios" preload="auto" src="mensaje3ejercicios.mp3"></audio>
    <audio id="mensaje4Ejercicios" preload="auto" src="mensaje4ejercicios.mp3"></audio>
    <audio id="respuestaCorrecta" preload="auto" src="respuestacorrecta.mp3"></audio>
    <audio id="primerError" preload="auto" src="primererror.mp3"></audio>
    <audio id="segundoError" preload="auto" src="segundoerror.mp3"></audio>
    <audio id="loLograste" preload="auto" src="lolograste.mp3"></audio>

    <audio id="hoverSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.m4a"></audio>
    <audio id="clickSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.m4a"></audio>
    <audio id="successSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.m4a"></audio>

    <button id="musicToggle" onclick="toggleMusic()">üîá</button>

    <div class="container">
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="FICDE" class="logo-img" onerror="this.style.display='none'; document.getElementById('altLogo').style.display='block'">
                <h2 id="altLogo" style="display:none; color:white; font-weight:800;">FICDE</h2>
            </div>
            <div class="module-tag">M√≥dulo Atenci√≥n Farmac√©utica. Dolencias Menores.</div>
        </header>

        <div id="selectionScreen">
            <div class="welcome-card">
                <div class="fede-avatar-large" onclick="playAudio('saludoInicial')">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <h1 class="welcome-title">Espacio de Repaso Interactivo</h1>
                <p style="color: var(--texto-secundario); font-size: 1.1rem;">Donde el conocimiento se convierte en acci√≥n</p>
            </div>

            <div class="blocks-grid">
                <div class="block-card" onclick="startModule('sintesis')">
                    <div class="block-icon">üß†</div>
                    <div class="block-title">S√≠ntesis</div>
                    <div class="block-desc">Grupos de medicamentos para dolencias menores, uso b√°sico de antiinflamatorios, analg√©sicos, antibi√≥ticos, antimic√≥ticos, gripe, resfr√≠o, dolor, cefaleas y fiebre.</div>
                </div>

                <div class="block-card" onclick="startModule('analisis')">
                    <div class="block-icon">üîç</div>
                    <div class="block-title">An√°lisis Cr√≠tico</div>
                    <div class="block-desc">Diferencias entre AINE y analg√©sicos, uso racional de antibi√≥ticos, manejo sintom√°tico de gripe y resfr√≠o, clasificaci√≥n del dolor, escalera OMS, cefaleas, fiebre y puntos clave en pediatr√≠a. </div>
                </div>

                <div class="block-card" onclick="startModule('escenarios')">
                    <div class="block-icon">üé¨</div>
                    <div class="block-title">Escenarios</div>
                    <div class="block-desc">Situaciones reales de resfr√≠o y gripe en mostrador, dolor musculoesquel√©tico, migra√±a conocida, fiebre en ni√±os, conjuntivitis, consultas de anticoncepci√≥n, pediatr√≠a, geriatr√≠a y criterios de derivaci√≥n.</div>
                </div>

                <div class="block-card" onclick="startModule('practica')">
                    <div class="block-icon">‚ö°</div>
                    <div class="block-title">Pr√°ctica</div>
                    <div class="block-desc">Ejercicios de definici√≥n, uso racional de antibi√≥ticos, identificaci√≥n de migra√±a, combinaciones para resfr√≠o, consejos breves de fiebre, anticoncepci√≥n, seguridad en pediatr√≠a y geriatr√≠a, y rol del auxiliar.</div>
                </div>
            </div>
        </div>

        <div id="activityScreen" class="activity-screen">
            <div class="tutor-sidebar">
                <div class="fede-avatar-large" style="width: 100px; height: 100px; border-color: var(--ficde-naranja);" onclick="replayTutorMessage()">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <div style="flex:1;">
                    <h3 style="color:var(--ficde-naranja); margin-bottom:5px;">Tutor Fede</h3>
                    <div class="tutor-bubble" id="tutorMessage"></div>
                </div>
            </div>

            <div class="activity-content" id="activityContainer"></div>
        </div>
    </div>

    <script>
        // ===== GESTI√ìN DE AUDIO MP3 =====
        const audioFiles = {
            saludoInicial: document.getElementById('saludoInicial'),
            mensaje1: document.getElementById('mensaje1Ejercicios'),
            mensaje2: document.getElementById('mensaje2Ejercicios'),
            mensaje3: document.getElementById('mensaje3Ejercicios'),
            mensaje4: document.getElementById('mensaje4Ejercicios'),
            correcto: document.getElementById('respuestaCorrecta'),
            error1: document.getElementById('primerError'),
            error2: document.getElementById('segundoError'),
            lolograste: document.getElementById('loLograste')
        };

        function playAudio(audioKey) {
            if (audioFiles[audioKey]) {
                audioFiles[audioKey].currentTime = 0;
                audioFiles[audioKey].play().catch(err => console.log('Error al reproducir audio:', err));
            }
        }

        const bgMusic = document.getElementById('bgMusic');
        const clickSoundEl = document.getElementById('clickSound');
        const successSoundEl = document.getElementById('successSound');
        const hoverSoundEl = document.getElementById('hoverSound');

        let musicOn = false;
        let audioUnlocked = false;

        function unlockAudio() {
            if (audioUnlocked) return;
            [clickSoundEl, successSoundEl, hoverSoundEl].forEach(a => {
                a.volume = 0;
                const p = a.play();
                if (p) p.then(() => { a.pause(); a.currentTime = 0; a.volume = 1; }).catch(()=>{});
            });
            audioUnlocked = true;
        }

        document.addEventListener('pointerdown', unlockAudio, { once: true });
        document.addEventListener('keydown', unlockAudio, { once: true });

        function toggleMusic() {
            unlockAudio();
            if (!musicOn) {
                bgMusic.volume = 0.1;
                bgMusic.play().catch(() => {});
                document.getElementById('musicToggle').innerText = 'üéµ';
            } else {
                bgMusic.pause();
                document.getElementById('musicToggle').innerText = 'üîá';
            }
            musicOn = !musicOn;
        }

        function playSound(type) {
            if (!audioUnlocked) return;
            try {
                if (type === 'click') { clickSoundEl.currentTime=0; clickSoundEl.volume=0.8; clickSoundEl.play().catch(()=>{}); }
                if (type === 'success') { successSoundEl.currentTime=0; successSoundEl.volume=0.8; successSoundEl.play().catch(()=>{}); }
                if (type === 'hover') { hoverSoundEl.currentTime=0; hoverSoundEl.volume=0.2; hoverSoundEl.play().catch(()=>{}); }
            } catch (e) {}
        }

        function wireUiSounds() {
            document.querySelectorAll('.block-card, .btn-action, .checklist-item, .traffic-row, .fede-avatar-large').forEach(el => {
                if (el.dataset.sound === '1') return;
                el.dataset.sound = '1';
                el.addEventListener('mouseenter', () => playSound('hover'));
                el.addEventListener('click', () => playSound('click'));
            });
        }

        window.addEventListener('load', wireUiSounds);

        // ===== NORMALIZACI√ìN DE TEXTO =====
        function normalizar(txt) {
            return txt
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .toLowerCase();
        }

       // ===== ACTIVIDADES: M√ìDULO ‚Äì ATENCI√ìN FARMAC√âUTICA EN DOLENCIAS MENORES (seg√∫n manual) ===
const modules = {

  // ===================== S√çNTESIS =====================
  sintesis: [
    {
      type: 'text',
      badge: 'Grupos',
      title: 'Grupos terap√©uticos b√°sicos',
      instruction: 'Con tus palabras: ¬øcu√°les son los principales grupos de medicamentos que se usan en dolencias menores y para qu√© sirven en general?',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('antiinflam') || v.includes('inflam')) &&
          (v.includes('analges') || v.includes('dolor')) &&
          (v.includes('antibiot') || v.includes('infeccion') || v.includes('infecci√≥n')) &&
          (v.includes('antimic') || v.includes('hongos') || v.includes('micos'))
        );
      },
      tutor: 'Pens√° en antiinflamatorios, analg√©sicos, antibi√≥ticos y antimic√≥ticos como grandes grupos para dolor, inflamaci√≥n, infecciones bacterianas y por hongos.',
      explanation: 'En dolencias menores se usan principalmente antiinflamatorios, analg√©sicos, antibi√≥ticos y antimic√≥ticos, cada uno dirigido a inflamaci√≥n, dolor, infecciones bacterianas o f√∫ngicas.'
    },
    {
      type: 'checklist',
      badge: 'AINE',
      title: 'Anti¬≠inflamatorios no esteroideos',
      instruction: 'Seleccion√° caracter√≠sticas correctas de los AINE (antiinflamatorios no esteroideos).',
      items: [
        { text: 'Se usan para tratar dolor e inflamaci√≥n', correct: true },
        { text: 'Est√°n relacionados qu√≠micamente con la aspirina', correct: true },
        { text: 'No tienen ning√∫n efecto adverso sobre el est√≥mago ni la presi√≥n arterial', correct: false },
        { text: 'Ejemplos: ibuprofeno, naproxeno, diclofenac, aspirina, ketorolac, dipirona', correct: true }
      ],
      tutor: 'Repas√° su mecanismo sobre prostaglandinas y los efectos adversos digestivos, renales y cardiovasculares.',
      explanation: 'Los AINE bloquean mediadores de la inflamaci√≥n, alivian dolor y fiebre, pero pueden causar irritaci√≥n g√°strica, alteraciones renales y cambios en la presi√≥n arterial.'
    },
    {
      type: 'traffic',
      badge: 'Corticoides',
      title: 'Corticoides: usos y l√≠mites',
      instruction: 'Marc√° en verde los enunciados correctos sobre corticoides.',
      items: [
        { text: 'Son antiinflamatorios esteroideos usados tambi√©n como inmunodepresores y antial√©rgicos', color: 'green' },
        { text: 'Pueden ser end√≥genos (producidos por las suprarrenales) o ex√≥genos (medicamentos)', color: 'green' },
        { text: 'Son de uso rutinario para tratar gripe y catarro com√∫n sin indicaci√≥n m√©dica', color: 'red' },
        { text: 'El uso prolongado ex√≥geno puede disminuir la producci√≥n natural y causar efectos adversos', color: 'green' }
      ],
      tutor: 'Pens√° en la diferencia entre corticoides producidos por el cuerpo y los administrados como f√°rmaco.',
      explanation: 'Los corticoides se usan en enfermedades inflamatorias y autoinmunes, pero su uso ex√≥geno prolongado tiene riesgos digestivos, hormonales e inmunol√≥gicos.'
    },
    {
      type: 'text',
      badge: 'Analgesia',
      title: 'Definici√≥n de analg√©sico',
      instruction: 'Defin√≠ qu√© es un analg√©sico y qu√© tipo de dolor ayudan a aliviar.',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('dolor') || v.includes('algia')) &&
          (v.includes('calmar') || v.includes('aliviar') || v.includes('disminuir')) &&
          (v.includes('tejido') || v.includes('golpe') || v.includes('enfermedad') || v.includes('proceso infecc'))
        );
      },
      tutor: 'Part√≠ de la idea AN = no y ALGIA = dolor, y vinc√∫lalo a dolores por golpes, infecciones o enfermedades.',
      explanation: 'Los analg√©sicos son f√°rmacos destinados a calmar o aliviar el dolor producido por lesiones tisulares, procesos infecciosos o diversas enfermedades. '
    },
    {
      type: 'checklist',
      badge: 'Analgesia tipos',
      title: 'Tipos de analg√©sicos',
      instruction: 'Seleccion√° enunciados correctos sobre tipos de analg√©sicos.',
      items: [
        { text: 'Los analg√©sicos no narc√≥ticos suelen ser derivados del paracetamol, con acci√≥n analg√©sica y antipir√©tica', correct: true },
        { text: 'Los analg√©sicos narc√≥ticos u opi√°ceos incluyen morfina, code√≠na, fentanilo, tramadol', correct: true },
        { text: 'Los opi√°ceos act√∫an principalmente en el sistema nervioso central sobre v√≠as del dolor', correct: true },
        { text: 'Todos los analg√©sicos son apropiados para dolencias menores sin control m√©dico', correct: false }
      ],
      tutor: 'Diferenci√° analg√©sicos no opioides de los opioides en potencia, mecanismo y riesgos.',
      explanation: 'Los analg√©sicos no narc√≥ticos se usan en dolor leve a moderado, mientras que los opi√°ceos se reservan para dolores intensos y requieren mayor control.'
    },
    {
      type: 'traffic',
      badge: 'Antibi√≥ticos',
      title: 'Uso adecuado de antibi√≥ticos',
      instruction: 'Marc√° en verde afirmaciones correctas sobre los antibi√≥ticos.',
      items: [
        { text: 'Son antimicrobianos que combaten infecciones bacterianas en tejidos del organismo', color: 'green' },
        { text: 'Son √∫tiles para tratar resfr√≠os, gripe y otras infecciones virales comunes', color: 'red' },
        { text: 'Pueden ser bactericidas (matan bacterias) o bacteriost√°ticos (inhiben su crecimiento)', color: 'green' },
        { text: 'El uso innecesario favorece la resistencia bacteriana futura', color: 'green' }
      ],
      tutor: 'Record√° la diferencia entre infecciones bacterianas y virales al recomendar o no un antibi√≥tico.',
      explanation: 'Los antibi√≥ticos act√∫an solo frente a bacterias, y su uso inadecuado en cuadros virales o sin control favorece resistencias y efectos adversos. '
    },
    {
      type: 'checklist',
      badge: 'Antibi√≥ticos EA',
      title: 'Efectos adversos de antibi√≥ticos',
      instruction: 'Seleccion√° posibles efectos adversos comunes de los antibi√≥ticos.',
      items: [
        { text: 'Reacciones al√©rgicas como urticaria, prurito o dificultad respiratoria', correct: true },
        { text: 'Alteraciones digestivas como n√°useas, diarrea o malestar estomacal', correct: true },
        { text: 'Crisis convulsivas en algunos casos y f√°rmacos', correct: true },
        { text: 'Incremento garantizado de la energ√≠a sin riesgo', correct: false }
      ],
      tutor: 'Pens√° en manifestaciones cut√°neas, digestivas y reacciones de hipersensibilidad.',
      explanation: 'Los antibi√≥ticos pueden provocar reacciones al√©rgicas, trastornos digestivos y en algunos casos efectos sobre el sistema nervioso central. '
    },
    {
      type: 'traffic',
      badge: 'Antimic√≥ticos',
      title: 'Micosis y antimic√≥ticos',
      instruction: 'Marc√° en verde enunciados correctos sobre micosis y tratamiento.',
      items: [
        { text: 'Los antimic√≥ticos inhiben o matan hongos causantes de micosis', color: 'green' },
        { text: 'Las micosis superficiales afectan piel, u√±as y mucosas', color: 'green' },
        { text: 'Las micosis sist√©micas pueden comprometer √≥rganos internos y ser graves', color: 'green' },
        { text: 'Todas las micosis se resuelven con medidas caseras sin tratamiento farmacol√≥gico', color: 'red' }
      ],
      tutor: 'Ubic√° el rol del farmac√©utico en prevenir, detectar y derivar seg√∫n gravedad.',
      explanation: 'Las micosis superficiales se tratan con antimic√≥ticos t√≥picos o sist√©micos, mientras que las sist√©micas requieren manejo m√©dico especializado.'
    },
    {
      type: 'checklist',
      badge: 'Gripe/resfr√≠o',
      title: 'Gripe vs resfr√≠o',
      instruction: 'Seleccion√° afirmaciones correctas que diferencian gripe y resfr√≠o.',
      items: [
        { text: 'La gripe suele dar fiebre alta, dolores musculares intensos y gran decaimiento', correct: true },
        { text: 'El resfr√≠o afecta principalmente la nariz con congesti√≥n y rinorrea leve', correct: true },
        { text: 'Ambas son enfermedades de origen viral respiratorio', correct: true },
        { text: 'Los antibi√≥ticos son el tratamiento de primera elecci√≥n en ambos casos', correct: false }
      ],
      tutor: 'Us√° los s√≠ntomas sist√©micos (fiebre alta, mialgias) para distinguir gripe del resfr√≠o com√∫n.',
      explanation: 'Gripe y resfr√≠o son infecciones virales, la primera m√°s sist√©mica y la segunda m√°s localizada en v√≠as respiratorias altas, sin indicaci√≥n rutinaria de antibi√≥ticos.'
    },
    {
      type: 'traffic',
      badge: 'Fiebre',
      title: 'Concepto de fiebre',
      instruction: 'Marc√° en verde enunciados correctos sobre la fiebre.',
      items: [
        { text: 'Es un aumento temporal de la temperatura por ajuste del centro termorregulador', color: 'green' },
        { text: 'Febr√≠cula es una temperatura menor de 38 ¬∞C', color: 'green' },
        { text: 'Siempre indica una infecci√≥n bacteriana grave', color: 'red' },
        { text: 'Puede deberse a infecciones, medicamentos, trastornos inflamatorios o golpes de calor', color: 'green' }
      ],
      tutor: 'Pens√° en el papel de la fiebre como respuesta del sistema inmune.',
      explanation: 'La fiebre refleja una elevaci√≥n regulada de la temperatura por m√∫ltiples causas, no siempre infecciosas ni bacterianas.'
    }
  ],

  // ===================== AN√ÅLISIS =====================
  analisis: [
    {
      type: 'text',
      badge: 'AINE vs analg√©sico',
      title: 'Diferencia AINE‚Äìanalg√©sico',
      instruction: 'Explic√° la diferencia entre un antiinflamatorio no esteroideo (AINE) y un analg√©sico no narc√≥tico.',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('antiinflam') || v.includes('inflam')) &&
          (v.includes('analg') || v.includes('dolor')) &&
          (v.includes('antipir') || v.includes('fiebre')) &&
          (v.includes('paracetamol') || v.includes('aine') || v.includes('ibuprofeno') || v.includes('aspirina'))
        );
      },
      tutor: 'Record√° que los AINE act√∫an sobre inflamaci√≥n adem√°s del dolor, y que el paracetamol tiene pobre acci√≥n antiinflamatoria.',
      explanation: 'Los AINE son analg√©sicos y antipir√©ticos con acci√≥n antiinflamatoria, mientras que analg√©sicos como el paracetamol tienen escasa acci√≥n sobre la inflamaci√≥n.'
    },
    {
      type: 'checklist',
      badge: 'AINE EA',
      title: 'Riesgos de AINE',
      instruction: 'Seleccion√° riesgos o efectos adversos frecuentes de los AINE.',
      items: [
        { text: 'Irritaci√≥n g√°strica, √∫lceras y acidez', correct: true },
        { text: 'Disminuci√≥n de la funci√≥n renal', correct: true },
        { text: 'Aumento de la presi√≥n arterial en algunos pacientes', correct: true },
        { text: 'Aumento inevitable de la masa muscular', correct: false }
      ],
      tutor: 'Relacion√° la inhibici√≥n de prostaglandinas con la protecci√≥n g√°strica y la funci√≥n renal.',
      explanation: 'Al interferir con prostaglandinas protectoras, los AINE pueden da√±ar mucosa g√°strica, reducir perfusi√≥n renal y elevar la presi√≥n arterial.'
    },
    {
      type: 'traffic',
      badge: 'Antibi√≥tico pr√°ctica',
      title: 'Cu√°ndo NO indicar antibi√≥tico',
      instruction: 'Marc√° en rojo las situaciones en que NO corresponde antibi√≥tico en dolencias menores.',
      items: [
        { text: 'Resfr√≠o com√∫n sin signos de complicaci√≥n bacteriana', color: 'red' },
        { text: 'Gripe t√≠pica con fiebre, mialgias y tos seca de origen viral', color: 'red' },
        { text: 'Faringitis viral sin exudado purulento ni sospecha de estreptococo', color: 'red' },
        { text: 'Infecci√≥n bacteriana confirmada por el m√©dico (ej. faringitis estreptoc√≥cica)', color: 'green' }
      ],
      tutor: 'Pens√° en la indicaci√≥n de antibi√≥ticos solo cuando hay sospecha o confirmaci√≥n bacteriana.',
      explanation: 'En cuadros virales t√≠picos no est√° indicado el uso de antibi√≥ticos, reserv√°ndose para infecciones bacterianas confirmadas o muy sospechosas.'
    },
    {
      type: 'checklist',
      badge: 'Gripe tto',
      title: 'Tratamiento sintom√°tico de gripe',
      instruction: 'Seleccion√° medidas correctas para tratar los s√≠ntomas de gripe en el mostrador.',
      items: [
        { text: 'Uso de paracetamol o ibuprofeno para fiebre y dolor', correct: true },
        { text: 'Sugerir reposo, hidrataci√≥n abundante y evitar alcohol y tabaco', correct: true },
        { text: 'Recomendar √°cido acetilsalic√≠lico en cualquier paciente sin evaluar riesgo', correct: false },
        { text: 'Orientar sobre combinaciones OTC con analg√©sico, antihistam√≠nico y descongestivo', correct: true }
      ],
      tutor: 'Apoyate en el manejo sintom√°tico y en las combinaciones habituales para resfr√≠o/gripe.',
      explanation: 'La gripe se maneja con antipir√©ticos, analg√©sicos, medidas generales y preparados combinados, evitando aspirina en grupos de riesgo. '
    },
    {
      type: 'traffic',
      badge: 'Resfr√≠o tto',
      title: 'Medicamentos para resfr√≠o com√∫n',
      instruction: 'Marc√° en verde afirmaciones correctas sobre el tratamiento del resfr√≠o.',
      items: [
        { text: 'Se manejan con reposo, l√≠quidos, humidificaci√≥n ambiental y dieta adecuada', color: 'green' },
        { text: 'Los antibi√≥ticos solo se usan si hay complicaciones bacterianas', color: 'green' },
        { text: 'Los preparados combinados pueden contener antihistam√≠nico, descongestivo, expectorante y antipir√©tico', color: 'green' },
        { text: 'Los anticongestivos nasales t√≥picos deben usarse indefinidamente sin l√≠mite de d√≠as', color: 'red' }
      ],
      tutor: 'Revis√° l√≠mites de uso de descongestivos t√≥picos y la falta de eficacia de antibi√≥ticos en resfr√≠os.',
      explanation: 'El resfr√≠o se trata con medidas de soporte y combinaciones sintom√°ticas, limitando el uso de descongestivos t√≥picos para evitar efecto rebote y dependencia.'
    },
    {
      type: 'checklist',
      badge: 'Dolor tipos',
      title: 'Clasificaci√≥n del dolor',
      instruction: 'Seleccion√° pares tipo‚Äìcaracter√≠stica correctamente asociados.',
      items: [
        { text: 'Dolor agudo: duraci√≥n limitada, poco componente psicol√≥gico', correct: true },
        { text: 'Dolor cr√≥nico: duraci√≥n prolongada, mayor componente psicol√≥gico', correct: true },
        { text: 'Dolor neurop√°tico: quemante, con hormigueo y alteraciones de sensibilidad', correct: true },
        { text: 'Dolor nociceptivo visceral: continuo, profundo, a veces con s√≠ntomas neurovegetativos', correct: true }
      ],
      tutor: 'Us√° la duraci√≥n, la localizaci√≥n y la sensaci√≥n subjetiva para clasificar el dolor.',
      explanation: 'El dolor se clasifica seg√∫n duraci√≥n, origen, localizaci√≥n y respuesta a f√°rmacos, lo que orienta la elecci√≥n terap√©utica apropiada.'
    },
    {
      type: 'traffic',
      badge: 'OMS escalera',
      title: 'Escalera analg√©sica OMS',
      instruction: 'Marc√° en verde principios b√°sicos de la escala analg√©sica de la OMS.',
      items: [
        { text: 'Empieza con no opioides y escala a opioides d√©biles y luego potentes seg√∫n respuesta', color: 'green' },
        { text: 'La intensidad del dolor debe cuantificarse para guiar el tratamiento', color: 'green' },
        { text: 'Mezclar siempre opioides d√©biles con potentes en el mismo paciente', color: 'red' },
        { text: 'Los coadyuvantes pueden usarse en cualquier fase seg√∫n el tipo de dolor', color: 'green' }
      ],
      tutor: 'Pens√° en los escalones 1 (no opioides), 2 (opioides d√©biles) y 3 (opioides potentes) con coadyuvantes.',
      explanation: 'La escala OMS propone un aumento progresivo de la potencia analg√©sica seg√∫n la intensidad del dolor, con uso racional de coanalg√©sicos.'
    },
    {
      type: 'checklist',
      badge: 'Cefalea alarma',
      title: 'Cefaleas: signos de alarma',
      instruction: 'Seleccion√° signos que justifican derivaci√≥n urgente en cefalea o migra√±a.',
      items: [
        { text: 'Fiebre y rigidez de nuca asociados al dolor de cabeza', correct: true },
        { text: 'Alteraciones visuales importantes (visi√≥n doble, luces, manchas intensas)', correct: true },
        { text: 'Hormigueos o debilidad en brazos y piernas', correct: true },
        { text: 'Cefalea leve, habitual, que mejora con un AINE com√∫n', correct: false }
      ],
      tutor: 'Distingu√≠ cefaleas benignas de las que pueden indicar patolog√≠a neurol√≥gica grave.',
      explanation: 'Cefaleas acompa√±adas de fiebre, d√©ficit neurol√≥gico o cambios bruscos requieren evaluaci√≥n m√©dica urgente.'
    },
    {
      type: 'traffic',
      badge: 'Fiebre tto',
      title: 'Tratamiento de la fiebre',
      instruction: 'Marc√° en verde enunciados correctos sobre el manejo farmacol√≥gico de la fiebre.',
      items: [
        { text: 'Paracetamol cada 4‚Äì6 horas e ibuprofeno cada 6‚Äì8 horas ayudan a reducir la fiebre', color: 'green' },
        { text: 'La fiebre leve siempre debe bajarse a valores totalmente normales', color: 'red' },
        { text: 'La dipirona puede usarse en fiebre persistente seg√∫n criterio profesional', color: 'green' },
        { text: 'En embarazadas y cardi√≥patas con fiebre alta se recomienda consulta m√©dica inmediata', color: 'green' }
      ],
      tutor: 'Record√° que el objetivo es aliviar el malestar m√°s que normalizar por completo la temperatura.',
      explanation: 'El manejo de la fiebre combina antipir√©ticos adecuados y criterios de derivaci√≥n seg√∫n edad, comorbilidades y persistencia.'
    },
    {
      type: 'checklist',
      badge: 'Pediatr√≠a',
      title: 'Puntos clave en pediatr√≠a',
      instruction: 'Seleccion√° consideraciones importantes al tratar con f√°rmacos en ni√±os.',
      items: [
        { text: 'Ajustar dosis por peso o superficie corporal sin superar dosis m√°ximas', correct: true },
        { text: 'Considerar sabor, textura y volumen de las formas orales l√≠quidas', correct: true },
        { text: 'Usar siempre presentaciones de adultos partiendo comprimidos sin control', correct: false },
        { text: 'Verificar edad y peso, y revisar alergias o enfermedades previas', correct: true }
      ],
      tutor: 'Pens√° en la adaptaci√≥n de dosis y formas farmac√©uticas a cada etapa del desarrollo.',
      explanation: 'En pediatr√≠a importa la dosificaci√≥n por peso, la forma farmac√©utica, la palatabilidad y la seguridad del principio activo.'
    }
  ],

  // ===================== ESCENARIOS =====================
  escenarios: [
    {
      type: 'text',
      badge: 'Resfr√≠o mostrador',
      title: 'Resfr√≠o sin fiebre alta',
      instruction: 'Un adulto consulta por congesti√≥n nasal, rinorrea y tos leve sin fiebre alta desde hace 2 d√≠as. ¬øQu√© recomend√°s en la farmacia y cu√°ndo le dir√≠as que consulte al m√©dico?',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('resfr') || v.includes('catarro') || v.includes('gripal')) &&
          (v.includes('reposo') || v.includes('liquidos') || v.includes('hidrat') || v.includes('humed')) &&
          (v.includes('descongest') || v.includes('antihist') || v.includes('paracetamol') || v.includes('ibuprofeno')) &&
          (v.includes('consult') || v.includes('medic') || v.includes('empeora') || v.includes('no mejora'))
        );
      },
      tutor: 'Incorpor√° medidas generales, combinados sintom√°ticos y criterios de derivaci√≥n (fiebre alta persistente, dificultad respiratoria, empeoramiento).',
      explanation: 'En un resfr√≠o leve se recomiendan medidas sintom√°ticas y OTC, derivando al m√©dico si aparecen fiebre alta, disnea o si el cuadro no mejora. '
    },
    {
      type: 'traffic',
      badge: 'Gripe escenario',
      title: 'Paciente con gripe',
      instruction: 'Marc√° en verde conductas adecuadas ante un paciente con s√≠ntomas t√≠picos de gripe.',
      items: [
        { text: 'Recomendar antipir√©ticos y analg√©sicos para fiebre y dolores', color: 'green' },
        { text: 'Sugerir reposo, buena hidrataci√≥n y evitar tabaco y alcohol', color: 'green' },
        { text: 'Ofrecer antibi√≥tico oral de amplio espectro sin prescripci√≥n', color: 'red' },
        { text: 'Indicar consulta m√©dica si es anciano, embarazada o tiene enfermedad cr√≥nica', color: 'green' }
      ],
      tutor: 'Distingu√≠ tu rol de apoyo sintom√°tico del rol del m√©dico para antivirales o manejo de complicaciones.',
      explanation: 'El farmac√©utico maneja la gripe con soporte sintom√°tico y reconoce grupos de riesgo que requieren valoraci√≥n m√©dica temprana. '
    },
    {
      type: 'checklist',
      badge: 'Dolor leve',
      title: 'Dolor leve musculoesquel√©tico',
      instruction: 'Seleccion√° las respuestas adecuadas ante un dolor muscular leve por esfuerzo.',
      items: [
        { text: 'Sugerir un AINE de baja dosis por tiempo corto si no hay contraindicaciones', correct: true },
        { text: 'Evaluar antecedentes de √∫lcera, insuficiencia renal o hipertensi√≥n antes de recomendar AINE', correct: true },
        { text: 'Ofrecer siempre opioides menores como primera opci√≥n', correct: false },
        { text: 'Recomendar medidas f√≠sicas como reposo relativo y fr√≠o local', correct: true }
      ],
      tutor: 'Apoyate en la escala analg√©sica: dolor leve se maneja con no opioides y medidas no farmacol√≥gicas.',
      explanation: 'Para dolores leves se priorizan AINE o paracetamol, junto a medidas f√≠sicas, evitando opioides sin indicaci√≥n m√©dica.'
    },
    {
      type: 'text',
      badge: 'Migra√±a mostrador',
      title: 'Consulta por migra√±a conocida',
      instruction: 'Una paciente con diagn√≥stico previo de migra√±a consulta por su crisis habitual, sin signos de alarma. ¬øQu√© tipo de medicaci√≥n pod√©s sugerir y qu√© signos te har√≠an derivarla de urgencia?',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('aine') || v.includes('antiinflam') || v.includes('ibuprofeno') || v.includes('naproxeno')) &&
          (v.includes('reposo') || v.includes('oscuro') || v.includes('disminuir estres')) &&
          (v.includes('fiebre') || v.includes('rigidez') || v.includes('vision') || v.includes('debilidad') || v.includes('hormigueo')) &&
          v.includes('consult')
        );
      },
      tutor: 'Mencion√° AINE como primera l√≠nea y signos neurol√≥gicos o fiebre que obligan a consulta inmediata.',
      explanation: 'En migra√±a conocida se usan AINE y medidas ambientales, derivando si aparecen signos at√≠picos o de alarma neurol√≥gica.'
    },
    {
      type: 'traffic',
      badge: 'Fiebre ni√±o',
      title: 'Fiebre en pediatr√≠a',
      instruction: 'Marc√° en verde actuaciones correctas ante un ni√±o con fiebre moderada sin otros signos graves.',
      items: [
        { text: 'Ajustar la dosis de paracetamol o ibuprofeno al peso del ni√±o', color: 'green' },
        { text: 'Usar la misma dosis que un adulto para simplificar', color: 'red' },
        { text: 'Aconsejar hidrataci√≥n y ropa ligera', color: 'green' },
        { text: 'Derivar si el ni√±o presenta convulsiones febriles o mal estado general', color: 'green' }
      ],
      tutor: 'No olvides la importancia de calcular bien la dosis por kilo y de vigilar el estado general.',
      explanation: 'El manejo de la fiebre pedi√°trica combina antipir√©ticos dosificados al peso y vigilancia de signos de gravedad o convulsiones.'
    },
    {
      type: 'checklist',
      badge: 'Conjuntivitis',
      title: 'Conjuntivitis en el mostrador',
      instruction: 'Seleccion√° acciones correctas ante ojos rojos, lagrimeo y secreci√≥n leve.',
      items: [
        { text: 'Sospechar conjuntivitis y preguntar por dolor, fotofobia intensa o alteraci√≥n visual', correct: true },
        { text: 'Recomendar higiene ocular y l√°grimas artificiales si no hay signos de alarma', correct: true },
        { text: 'Sugerir colirios antibi√≥ticos seg√∫n protocolos locales cuando sea compatible con conjuntivitis bacteriana leve', correct: true },
        { text: 'Indicar compartir toallas y maquillaje porque no es contagiosa', correct: false }
      ],
      tutor: 'Diferenci√° cuadros leves de signos que requieren derivaci√≥n al oftalm√≥logo.',
      explanation: 'La conjuntivitis requiere higiene, posible tratamiento t√≥pico y medidas para evitar contagios, derivando si hay compromiso visual o dolor intenso.'
    },
    {
      type: 'text',
      badge: 'Anticoncepci√≥n',
      title: 'Consulta sobre anticonceptivos',
      instruction: 'Una usuaria pide informaci√≥n sobre m√©todos anticonceptivos disponibles en farmacia. Mencion√° dos m√©todos de barrera y dos hormonales que puedas describir brevemente.',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('preservativo') || v.includes('condon') || v.includes('cond√≥n') || v.includes('diafragma')) &&
          (v.includes('pildora') || v.includes('p√≠ldora') || v.includes('combinada') || v.includes('minipildora') || v.includes('minip√≠ldora') || v.includes('implante') || v.includes('inyecc') || v.includes('parche'))
        );
      },
      tutor: 'Nombr√° preservativo masculino/femenino, diafragma y ejemplos de p√≠ldoras, implantes, inyecciones o parches.',
      explanation: 'Los m√©todos de barrera impiden el paso de espermatozoides, mientras que los hormonales modifican el ciclo ovulatorio y la receptividad endometrial. '
    },
    {
      type: 'traffic',
      badge: 'Pediatr√≠a escenario',
      title: 'Medicamento en ni√±o peque√±o',
      instruction: 'Marc√° en verde enunciados correctos al dispensar medicaci√≥n oral l√≠quida a un ni√±o menor de 5 a√±os.',
      items: [
        { text: 'Verificar la dosis en mg/kg y el volumen a administrar', color: 'green' },
        { text: 'Comprobar que el volumen por toma no supere los 5 ml en menores de 5 a√±os si es posible', color: 'green' },
        { text: 'Ignorar sabor y textura porque no influyen en la adherencia', color: 'red' },
        { text: 'Revisar alergias y comorbilidades antes de recomendar un OTC', color: 'green' }
      ],
      tutor: 'Pens√° en la practicidad de la forma farmac√©utica y en la seguridad de la dosis.',
      explanation: 'En pediatr√≠a se cuidan tanto la precisi√≥n de la dosis como la aceptabilidad organol√©ptica del medicamento.'
    },
    {
      type: 'checklist',
      badge: 'Geriatr√≠a',
      title: 'Polimedicaci√≥n en el anciano',
      instruction: 'Seleccion√° problemas asociados a la polimedicaci√≥n en geriatr√≠a.',
      items: [
        { text: 'Mayor riesgo de interacciones y reacciones adversas', correct: true },
        { text: 'Esquemas terap√©uticos complejos y dif√≠cil adherencia', correct: true },
        { text: 'Necesidad de coordinaci√≥n entre varios especialistas', correct: true },
        { text: 'Ausencia total de impacto sobre el estado nutricional', correct: false }
      ],
      tutor: 'Relacion√° la polimedicaci√≥n con cambios en farmacocin√©tica y fragilidad en el adulto mayor.',
      explanation: 'La polimedicaci√≥n en geriatr√≠a incrementa el riesgo de efectos adversos, interacciones y problemas de cumplimiento, requiriendo revisi√≥n peri√≥dica de tratamientos.'
    },
    {
      type: 'text',
      badge: 'Derivaci√≥n',
      title: 'Criterios de derivaci√≥n al m√©dico',
      instruction: 'Redact√° dos ejemplos de situaciones en dolencias menores en las que deb√©s derivar al m√©dico en lugar de sugerir solo tratamiento OTC.',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          v.includes('fiebre') &&
          (v.includes('alta') || v.includes('persistente') || v.includes('convulsion') || v.includes('convulsi√≥n')) &&
          (v.includes('dolor de cabeza') || v.includes('cefalea') || v.includes('vision') || v.includes('debilidad') || v.includes('pecho') || v.includes('torac') || v.includes('tor√°c')) &&
          v.includes('consult')
        );
      },
      tutor: 'Pod√©s mencionar fiebre alta persistente, cefalea con signos neurol√≥gicos, dolor tor√°cico intenso, disnea importante o empeoramiento r√°pido.',
      explanation: 'En atenci√≥n farmac√©utica es clave reconocer l√≠mites del autotratamiento y derivar cuando hay signos de gravedad o falta de respuesta.'
    }
  ],

  // ===================== PR√ÅCTICA =====================
  practica: [
    {
      type: 'blanks',
      badge: 'AINE definici√≥n',
      title: 'Definir AINE',
      instruction: 'Complet√°: un AINE es un f√°rmaco que act√∫a como ______, ______ y ______, y que adem√°s reduce la ______.',
      blanks: ['analg√©sico', 'antipir√©tico', 'antiinflamatorio', 'inflamaci√≥n'],
      tutor: 'Record√° las tres acciones principales de estos medicamentos.',
      explanation: 'Los AINE son analg√©sicos, antipir√©ticos y antiinflamatorios usados ampliamente en dolencias menores.'
    },
    {
      type: 'checklist',
      badge: 'Antibi√≥tico NO',
      title: 'Cu√°ndo no dar antibi√≥tico',
      instruction: 'Seleccion√° situaciones donde no corresponde recomendar antibi√≥ticos desde la farmacia.',
      items: [
        { text: 'Resfr√≠o com√∫n de 3 d√≠as sin fiebre alta ni signos de gravedad', correct: true },
        { text: 'Gripe t√≠pica en adulto sano sin complicaciones', correct: true },
        { text: 'Dolor de garganta claramente viral sin exudado ni fiebre alta', correct: true },
        { text: 'Infecci√≥n bacteriana diagnosticada y con receta m√©dica', correct: false }
      ],
      tutor: 'Aplic√° el concepto de uso racional de antibi√≥ticos en infecciones virales.',
      explanation: 'Evitar antibi√≥ticos en cuadros virales ayuda a prevenir resistencias y efectos adversos innecesarios.'
    },
    {
      type: 'traffic',
      badge: 'Migra√±a vs cefalea',
      title: 'Identificar migra√±a',
      instruction: 'Marc√° en verde caracter√≠sticas t√≠picas de la migra√±a frente a otras cefaleas.',
      items: [
        { text: 'Dolor puls√°til, hemicraneal, que empeora con la actividad f√≠sica', color: 'green' },
        { text: 'Acompa√±ado de n√°useas, fotofobia y fonofobia', color: 'green' },
        { text: 'Dolor opresivo en casco, leve a moderado, sin n√°useas', color: 'red' },
        { text: 'Posibles desencadenantes: estr√©s, menstruaci√≥n, ciertos alimentos', color: 'green' }
      ],
      tutor: 'Contrasta migra√±a con cefalea tensional y otras formas de dolor de cabeza.',
      explanation: 'La migra√±a se reconoce por su car√°cter puls√°til, s√≠ntomas acompa√±antes y desencadenantes espec√≠ficos.'
    },
    {
      type: 'checklist',
      badge: 'Combo resfr√≠o',
      title: 'Componentes de un combinado para resfr√≠o',
      instruction: 'Seleccion√° f√°rmacos que suelen aparecer combinados en productos para resfr√≠o.',
      items: [
        { text: 'Paracetamol como analg√©sico y antipir√©tico', correct: true },
        { text: 'Antihistam√≠nicos como clorfeniramina o loratadina', correct: true },
        { text: 'Descongestivos como pseudoefedrina', correct: true },
        { text: 'Antibi√≥tico de amplio espectro de uso sist√©mico', correct: false }
      ],
      tutor: 'Record√° ejemplos de marcas que combinan estos principios activos para tratar varios s√≠ntomas.',
      explanation: 'Los preparados para resfr√≠o suelen combinar analg√©sicos, antihistam√≠nicos, descongestivos y a veces expectorantes.'
    },
    {
      type: 'text',
      badge: 'Consejo fiebre',
      title: 'Consejo breve para fiebre',
      instruction: 'Redact√° un consejo que dar√≠as a un adulto con fiebre moderada sin otros s√≠ntomas graves que compra paracetamol.',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('dosis') || v.includes('cada') || v.includes('horas')) &&
          (v.includes('no exced') || v.includes('maxima') || v.includes('m√°xima')) &&
          (v.includes('hidrat') || v.includes('liquidos')) &&
          (v.includes('consult') || v.includes('medic') || v.includes('si empeora') || v.includes('no mejora'))
        );
      },
      tutor: 'Inclu√≠ intervalo de dosis, l√≠mite diario, hidrataci√≥n y signos para consultar al m√©dico.',
      explanation: 'El consejo debe promover el uso seguro del antipir√©tico, medidas generales y criterios de derivaci√≥n. '
    },
    {
      type: 'blanks',
      badge: 'Fiebre valores',
      title: 'Rango de fiebre',
      instruction: 'Complet√°: se considera ______ a la temperatura menor de 38 ¬∞C y ______ cuando supera los 38 ¬∞C.',
      blanks: ['febr√≠cula', 'fiebre'],
      tutor: 'Tom√° como referencia la definici√≥n del manual sobre valores de temperatura.',
      explanation: 'Distinguir febr√≠cula de fiebre ayuda a valorar la gravedad y decidir el manejo adecuado.'
    },
    {
      type: 'traffic',
      badge: 'Anticoncepci√≥n pr√°ctica',
      title: 'Elegir m√©todo anticonceptivo',
      instruction: 'Marc√° en verde enunciados correctos sobre m√©todos anticonceptivos vistos en el manual.',
      items: [
        { text: 'El preservativo masculino protege frente a embarazo y ETS', color: 'green' },
        { text: 'La p√≠ldora combinada tiene eficacia superior al 99% si se usa correctamente', color: 'green' },
        { text: 'El DIU no contiene hormonas y crea un entorno hostil para el esperma', color: 'green' },
        { text: 'La ‚Äúp√≠ldora del d√≠a despu√©s‚Äù es un m√©todo anticonceptivo de uso habitual', color: 'red' }
      ],
      tutor: 'Diferenci√° m√©todos de barrera, hormonales y dispositivos intrauterinos.',
      explanation: 'Cada m√©todo anticonceptivo tiene mecanismo, eficacia y usos espec√≠ficos, y la p√≠ldora de emergencia no se considera m√©todo de rutina.'
    },
    {
      type: 'checklist',
      badge: 'Pediatr√≠a pr√°ctica',
      title: 'Check pedi√°trico antes de recomendar',
      instruction: 'Seleccion√° pasos que deber√≠as seguir ante una dolencia menor en un ni√±o.',
      items: [
        { text: 'Comprobar edad y peso antes de calcular la dosis', correct: true },
        { text: 'Evitar combinados complejos en menores sin indicaci√≥n m√©dica', correct: true },
        { text: 'Usar solo medicamentos aprobados para la edad pedi√°trica', correct: true },
        { text: 'Asumir que las dosis de adultos son seguras reduci√©ndolas ‚Äúa ojo‚Äù', correct: false }
      ],
      tutor: 'Pens√° en seguridad, autorizaci√≥n para uso pedi√°trico y ajuste de dosis.',
      explanation: 'La seguridad en pediatr√≠a se basa en dosis calculadas, f√°rmacos adecuados a la edad y prudencia con combinaciones OTC.'
    },
    {
      type: 'text',
      badge: 'Geriatr√≠a pr√°ctica',
      title: 'Revisi√≥n r√°pida en geriatr√≠a',
      instruction: 'Describ√≠ brevemente qu√© revisar√≠as antes de sugerir un AINE a un paciente geri√°trico polimedicado.',
      validation: (raw) => {
        const v = normalizar(raw);
        return (
          (v.includes('medicacion') || v.includes('medicaci√≥n') || v.includes('polimedic') || v.includes('lista de medicamentos')) &&
          (v.includes('estomago') || v.includes('√∫lcera') || v.includes('gast') || v.includes('renal') || v.includes('ri√±on') || v.includes('presion') || v.includes('presi√≥n')) &&
          (v.includes('interaccion') || v.includes('interacci√≥n') || v.includes('riesgo')) &&
          v.includes('consult')
        );
      },
      tutor: 'Mencion√° antecedentes digestivos, renales, cardiovasculares y posibles interacciones.',
      explanation: 'En geriatr√≠a la indicaci√≥n de AINE exige revisar comorbilidades, medicaci√≥n concomitante y riesgo de efectos adversos.'
    },
    {
      type: 'checklist',
      badge: 'Rol auxiliar',
      title: 'Rol del auxiliar en dolencias menores',
      instruction: 'Seleccion√° funciones adecuadas del auxiliar de farmacia en la atenci√≥n de dolencias menores.',
      items: [
        { text: 'Orientar sobre el uso correcto de medicamentos OTC y medidas no farmacol√≥gicas', correct: true },
        { text: 'Identificar signos de alarma que requieren derivaci√≥n m√©dica', correct: true },
        { text: 'Prescribir antibi√≥ticos o opioides sin receta', correct: false },
        { text: 'Promover el uso racional de medicamentos evitando abusos y duplicidades', correct: true }
      ],
      tutor: 'Pens√° en un rol de educaci√≥n, seguridad y detecci√≥n precoz de problemas m√°s graves.',
      explanation: 'El auxiliar es clave para la educaci√≥n sanitaria, el uso responsable de f√°rmacos y la derivaci√≥n oportuna en la farmacia comunitaria.'
    }
  ]
};

        let currentModule = '';
        let currentIndex = 0;
        let attemptCount = 0;
        let lastAudioModule = null;

        // ===== MAPEO DE M√ìDULOS A AUDIOS =====
        const moduloAudioMap = {
            'sintesis': 'mensaje1',
            'analisis': 'mensaje2',
            'escenarios': 'mensaje3',
            'practica': 'mensaje4'
        };

        function startModule(id) {
            playSound('click');
            currentModule = id;
            currentIndex = 0;
            attemptCount = 0;
            lastAudioModule = id;

            // Reproducir el audio del m√≥dulo correspondiente
            const audioKey = moduloAudioMap[id];
            if (audioKey) {
                playAudio(audioKey);
            }

            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('activityScreen').classList.add('active');

            setTimeout(loadActivity, 300);
        }

        function loadActivity() {
            attemptCount = 0;

            if (currentIndex >= modules[currentModule].length) {
                // Reproducir "lolograste.mp3" al terminar TODAS las preguntas
                playAudio('lolograste');
                playSound('success');
                alert('¬°Excelente! Completaste este bloque.');
                setTimeout(() => {
                    location.reload();
                }, 2000);
                return;
            }

            const data = modules[currentModule][currentIndex];
            const container = document.getElementById('activityContainer');

            const msg = `Pregunta ${currentIndex + 1} de ${modules[currentModule].length}: ${data.tutor}`;
            document.getElementById('tutorMessage').innerText = msg;

            let html = `<span class="act-badge">${data.badge}</span>
                        <h2 class="act-title">${data.title}</h2>
                        <p class="act-instruction">${data.instruction}</p>`;

            if (data.type === 'text') {
                html += `<textarea id="txtInput" class="student-input" placeholder="Escribe tu respuesta con tus palabras..."></textarea>`;
            } else if (data.type === 'blanks') {
                html += `<div style="font-size:1.2rem; line-height:2.5;">`;
                data.blanks.forEach((b, i) => {
                    html += `${i + 1}. <input type="text" class="fill-input" data-ans="${b}"> <br>`;
                });
                html += `</div>`;
            } else if (data.type === 'traffic') {
                data.items.forEach((item, i) => {
                    html += `<div class="traffic-row" id="row-${i}">
                                <span>${item.text}</span>
                                <div style="display:flex; gap:10px;">
                                    <div class="traffic-btn bg-green" onclick="selTraffic(${i}, 'green')"></div>
                                    <div class="traffic-btn bg-yellow" onclick="selTraffic(${i}, 'yellow')"></div>
                                    <div class="traffic-btn bg-red" onclick="selTraffic(${i}, 'red')"></div>
                                </div>
                            </div>`;
                });
            } else if (data.type === 'checklist') {
                data.items.forEach((item) => {
                    html += `<div class="checklist-item" onclick="toggleCheck(this)" data-correct="${item.correct}">
                                <div class="check-box"></div>
                                <span>${item.text}</span>
                            </div>`;
                });
            }

            html += `<div id="feedback" class="feedback-area"></div>
                     <button id="btnCheck" class="btn-action" onclick="validate()">Verificar respuesta</button>
                     <button class="btn-action btn-back" onclick="location.reload()">Salir al men√∫</button>`;

            container.innerHTML = html;
            wireUiSounds();
        }

        let trafficAns = {};

        function selTraffic(idx, color) {
            trafficAns[idx] = color;
            const row = document.getElementById(`row-${idx}`);
            row.querySelectorAll('.traffic-btn').forEach(b => b.classList.remove('active'));
            row.querySelector(`.bg-${color}`).classList.add('active');
            playSound('click');
        }

        function toggleCheck(el) {
            el.classList.toggle('selected');
            el.querySelector('.check-box').innerText = el.classList.contains('selected') ? '‚úì' : '';

            if (el.classList.contains('selected')) {
                el.style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.background = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.color = 'white';
            } else {
                el.style.borderColor = 'transparent';
                el.querySelector('.check-box').style.background = 'transparent';
                el.querySelector('.check-box').style.borderColor = '#ccc';
            }

            playSound('click');
        }

        function validate() {
            const data = modules[currentModule][currentIndex];
            const feedback = document.getElementById('feedback');
            let isCorrect = false;

            if (data.type === 'text') {
                const val = document.getElementById('txtInput').value;
                isCorrect = data.validation(val);
            } else if (data.type === 'blanks') {
                const inputs = document.querySelectorAll('.fill-input');
                let hits = 0;
                inputs.forEach(inp => {
                    const v = normalizar(inp.value);
                    const ans = normalizar(inp.dataset.ans);
                    if (v.length > 1 && ans.startsWith(v.slice(0, Math.max(2, Math.min(v.length, ans.length))))) hits++;
                });
                isCorrect = (hits === data.blanks.length);
            } else if (data.type === 'traffic') {
                let hits = 0;
                data.items.forEach((item, i) => { if (trafficAns[i] === item.color) hits++; });
                isCorrect = (hits === data.items.length);
            } else if (data.type === 'checklist') {
                let correct = true;
                document.querySelectorAll('.checklist-item').forEach(item => {
                    const sel = item.classList.contains('selected');
                    const should = item.dataset.correct === 'true';
                    if (sel !== should) correct = false;
                });
                isCorrect = correct;
            }

            feedback.style.display = 'block';

            if (isCorrect) {
                playAudio('correcto');
                playSound('success');
                feedback.className = 'feedback-area feedback-success';
                feedback.innerHTML = `<strong>¬°Muy bien!</strong><br>${data.explanation}`;
                document.getElementById('btnCheck').innerText = 'Siguiente pregunta ‚Üí';
                document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
            } else {
                attemptCount++;

                if (attemptCount < 2) {
                    playAudio('error1');
                    feedback.className = 'feedback-area feedback-retry';
                    feedback.innerHTML = `<strong>Buen intento.</strong> Revis√° tu respuesta. Pista: ${data.tutor}`;
                } else {
                    playAudio('error2');
                    feedback.className = 'feedback-area feedback-fail';
                    feedback.innerHTML = `<strong>No pasa nada, aprendamos juntos:</strong><br>${data.explanation}`;
                    document.getElementById('btnCheck').innerText = 'Entendido, continuar ‚Üí';
                    document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
                }
            }
        }

        function replayTutorMessage() {
            // Replay del √∫ltimo audio de m√≥dulo reproducido
            if (lastAudioModule) {
                const audioKey = moduloAudioMap[lastAudioModule];
                if (audioKey) {
                    playAudio(audioKey);
                }
            }
        }
    </script>
</body>
</html>